"use strict";exports.id=791,exports.ids=[791],exports.modules={73791:(e,a,t)=>{t.r(a),t.d(a,{"0000baa0dcad8d46707b8d773e2385ee3a4afceecf":()=>N,"0026eb2f420dbe19721071b93939e12042b936d2b9":()=>u,"00d9909268c6282437558928b9eb7fe52fa09feb7d":()=>l,"00da94c5e624ddc6ef000e2b169d099c73b17ffb28":()=>s.q,"401441da709772ee89b3e49800a4a4a6dc26ee493f":()=>y,"402415848bad2cd42d5d95907fceecf1f4cf5c8b70":()=>b,"402f63c8b556e69e0ddb36434c2318ec2275eecabc":()=>d,"40591c1df497acc7e31ceed3e74b922b43ab441fcd":()=>m,"40666724d26ab1c8c34eb6dd40c71f1f02833b5d96":()=>p,"407c04408e94abbb077c15edf333b24f1198a40036":()=>g,"409501c61d6773bc887e08a5e0718debd979483294":()=>h,"40a0b3714b14238cf46e9331e5a5b91eb39cc77147":()=>o,"40ea010dd8077db007a17efc2af9fdd0d4b96934e7":()=>f,"40f046c771729028e0d9ad97f923daa3e768fe04b1":()=>i,"602d65bdc1356a11ea4724e3c470d7a1c30c099e95":()=>A,"603630e433ca204a1dbae2d035c2beb7cf9ce1ec1a":()=>w,"70c62eb784636b5509fdf72b5263e8b166a80a2c46":()=>z});var s=t(40530),r=t(21590);t(70376);var c=t(70709),n=t(8805);async function i(e){try{if(await c.z.user.findFirst({where:{email:e.email}}))return{success:!1};return{success:!!await c.z.user.create({data:{firstName:e.firstName,lastName:e.lastName,surName:e.surName,email:e.email,password:(0,n.hashSync)(e.password,10),startTest:e.startTest,organisation:e.organisation,role:e.role,okAnswers:0,testsResult:"[]"}})}}catch(e){return console.log(e),{success:!1}}}async function d(e){try{return await c.z.user.update({where:{id:e.id},data:{firstName:e.firstName,lastName:e.lastName,email:e.email}}),{edit:!0}}catch(e){return console.error(e),{edit:!1}}}async function l(){try{return await c.z.user.findMany({where:{role:{in:["SCHOOLBOY","STUDENT","SPECIALIST"]}},select:{id:!0,firstName:!0,lastName:!0,surName:!0,email:!0,organisation:!0,role:!0,startTest:!0,testPassed:!0,passedDate:!0,testsResult:!0,okAnswers:!0}})}catch(e){return console.log(e),[]}}async function o(e){try{return await c.z.test.create({data:{category:e.category,name:e.name,nameTranslit:function(e){let a={а:"a",б:"b",в:"v",г:"g",д:"d",е:"e",ё:"e",ж:"zh",з:"z",и:"i",й:"y",к:"k",л:"l",м:"m",н:"n",о:"o",п:"p",р:"r",с:"s",т:"t",у:"u",ф:"f",х:"h",ц:"c",ч:"ch",ш:"sh",щ:"sch",ь:"",ы:"y",ъ:"",э:"e",ю:"yu",я:"ya"};e=e.toLowerCase();let t="";for(let s=0;s<e.length;++s)void 0==a[e[s]]?t+=e[s]:t+=a[e[s]];return t=(t=(t=t.replace(/[^-0-9a-z]/g,"-")).replace(/[-]+/g,"-")).replace(/^\-|-$/g,"")}(e.name),text:"[]"}})}catch(e){return e}}async function u(){try{return await c.z.test.findMany({select:{id:!0,name:!0,nameTranslit:!0,category:!0,testDisable:!0}})}catch(e){return console.log(e),[]}}async function f(e){await c.z.test.delete({where:{id:e}})}async function b(e){let a=await c.z.test.findFirst({where:{id:e},select:{testDisable:!0}});console.log(a),a?.testDisable==!0?await c.z.test.update({where:{id:e},data:{testDisable:!1}}):await c.z.test.update({where:{id:e},data:{testDisable:!0}})}async function m(e){try{return await c.z.test.findUnique({where:{id:e}})}catch(e){return console.log(e),null}}async function w(e,a){try{return await c.z.test.update({where:{id:e},data:{text:JSON.stringify(a)}})}catch(e){return console.log(e),e}}async function y(e){try{return await c.z.test.findUnique({where:{id:e},select:{name:!0}})}catch(e){return console.log(e),[]}}async function h(e){try{return await c.z.test.findUnique({where:{id:e},select:{text:!0}})}catch(e){return console.log(e),[]}}async function p(e){try{return await c.z.test.findMany({where:{category:{in:[e]}},select:{id:!0}})}catch(e){return console.log(e),[]}}async function g(e){try{return await c.z.test.findFirst({where:{nameTranslit:e},select:{name:!0,text:!0}})}catch(e){return console.log(e),e}}async function A(e,a){try{let t=await c.z.user.update({where:{id:e},data:{testPassed:!0,testsResult:a}});return console.log(t),t}catch(e){console.log(e)}}async function z(e,a,t){try{let s=await c.z.user.update({where:{id:e},data:{testPassed:!0,okAnswers:a,passedDate:t}});return console.log(s),s}catch(e){console.log(e)}}async function N(){try{return await c.z.user.findMany({where:{role:{in:["SCHOOLBOY","STUDENT","SPECIALIST"]}},select:{id:!0,firstName:!0,lastName:!0,surName:!0,email:!0,organisation:!0,testPassed:!0,startTest:!0,passedDate:!0,role:!0,testsResult:!0}})}catch(e){throw console.error("Ошибка:",e),Error("Ошибка при получении данных пользователей")}}(0,t(99344).D)([i,d,l,o,u,f,b,m,w,y,h,p,g,A,z,N]),(0,r.A)(i,"40f046c771729028e0d9ad97f923daa3e768fe04b1",null),(0,r.A)(d,"402f63c8b556e69e0ddb36434c2318ec2275eecabc",null),(0,r.A)(l,"00d9909268c6282437558928b9eb7fe52fa09feb7d",null),(0,r.A)(o,"40a0b3714b14238cf46e9331e5a5b91eb39cc77147",null),(0,r.A)(u,"0026eb2f420dbe19721071b93939e12042b936d2b9",null),(0,r.A)(f,"40ea010dd8077db007a17efc2af9fdd0d4b96934e7",null),(0,r.A)(b,"402415848bad2cd42d5d95907fceecf1f4cf5c8b70",null),(0,r.A)(m,"40591c1df497acc7e31ceed3e74b922b43ab441fcd",null),(0,r.A)(w,"603630e433ca204a1dbae2d035c2beb7cf9ce1ec1a",null),(0,r.A)(y,"401441da709772ee89b3e49800a4a4a6dc26ee493f",null),(0,r.A)(h,"409501c61d6773bc887e08a5e0718debd979483294",null),(0,r.A)(p,"40666724d26ab1c8c34eb6dd40c71f1f02833b5d96",null),(0,r.A)(g,"407c04408e94abbb077c15edf333b24f1198a40036",null),(0,r.A)(A,"602d65bdc1356a11ea4724e3c470d7a1c30c099e95",null),(0,r.A)(z,"70c62eb784636b5509fdf72b5263e8b166a80a2c46",null),(0,r.A)(N,"0000baa0dcad8d46707b8d773e2385ee3a4afceecf",null)},40530:(e,a,t)=>{t.d(a,{q:()=>b});var s=t(21590);t(70376);var r=t(24118),c=t.n(r),n=t(24871),i=t(70709),d=t(37067),l=t(8805),o=t(20441);let u=new(t(96330)).PrismaClient,f={adapter:(0,d.y)(u),pages:{verifyRequest:"/verification-request"},providers:[(0,o.A)({server:{host:process.env.EMAIL_SERVER_HOST,port:process.env.EMAIL_SERVER_PORT,auth:{user:process.env.EMAIL_SERVER_USER,pass:process.env.EMAIL_SERVER_PASSWORD}},from:process.env.EMAIL_FROM}),(0,n.A)({name:"Credentials",credentials:{email:{label:"Email",type:"text"},password:{label:"Password",type:"password"}},async authorize(e){if(!e)return null;let a={email:e.email},t=await i.z.user.findFirst({where:a});return t&&await (0,l.compare)(e.password,t.password)?{id:t.id,name:t.firstName,lastName:t.lastName,surName:t.surName,password:t.password,email:t.email,emailVerified:t.emailVerified,organisation:t.organisation,testPassed:t.testPassed,passedDate:t.passedDate,startTest:t.startTest,role:t.role,testsResult:t.testsResult,okAnswers:t.okAnswers}:null}})],secret:process.env.NEXTAUTH_SECRET,session:{strategy:"jwt"},callbacks:{async signIn({user:e,account:a}){try{if(a?.provider==="credentials")return console.log("всё кайф"),!0;if(!e?.email)return!1;if(a?.provider==="email"){if(await i.z.user.findFirst({where:{email:e.email}}))return!0;return!1}let t=await i.z.user.findFirst({where:{email:e.email}});return console.log(t),!!t}catch(e){console.log("Error [SIGN IN]",e)}return!1},async jwt({token:e}){if(!e.email)return e;let a=await i.z.user.findFirst({where:{email:e.email}});return a&&(e.id=a.id,e.email=a.email,e.name=a.firstName,e.role=a.role),e},session:({session:e,token:a})=>(e?.user&&(e.user.id=a.id,e.user.role=a.role),e)}};async function b(){let e=await (0,r.getServerSession)(f);if(e?.user)return await i.z.user.findFirst({where:{id:e.user.id}})}c()(f),(0,t(99344).D)([b]),(0,s.A)(b,"00da94c5e624ddc6ef000e2b169d099c73b17ffb28",null)},70709:(e,a,t)=>{t.d(a,{z:()=>r});var s=t(96330);let r=globalThis.prismaGlobal??new s.PrismaClient}};